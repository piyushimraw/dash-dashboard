---
phase: 01-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/mfe-types/package.json
  - packages/mfe-types/tsconfig.json
  - packages/mfe-types/src/index.ts
  - packages/mfe-types/src/mfe-registry.ts
  - packages/mfe-types/src/auth.ts
  - packages/mfe-types/src/navigation.ts
autonomous: true

must_haves:
  truths:
    - "@packages/mfe-types builds independently"
    - "MFE registry types are exported"
    - "Auth service interface is defined"
  artifacts:
    - path: "packages/mfe-types/package.json"
      provides: "MFE type contracts"
      contains: "@packages/mfe-types"
    - path: "packages/mfe-types/src/mfe-registry.ts"
      provides: "MFE metadata types"
      contains: "MfeMetadata"
    - path: "packages/mfe-types/src/auth.ts"
      provides: "Auth service interface"
      contains: "AuthService"
  key_links:
    - from: "packages/mfe-types/tsconfig.json"
      to: "tsconfig.base.json"
      via: "extends"
      pattern: "extends.*tsconfig.base.json"
---

<objective>
Create @packages/mfe-types with MFE registry types and auth service contracts

Purpose: Define the type-safe contracts between shell and MFEs. This package provides compile-time verification of MFE-shell interfaces.
Output: Buildable types package with MFE registry, auth, and navigation type definitions
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure/01-RESEARCH.md
@.planning/phases/01-infrastructure/01-CONTEXT.md
@.planning/phases/01-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure @packages/mfe-types with complete type contracts</name>
  <files>
    - packages/mfe-types/package.json
    - packages/mfe-types/tsconfig.json
    - packages/mfe-types/src/index.ts
    - packages/mfe-types/src/mfe-registry.ts
    - packages/mfe-types/src/auth.ts
    - packages/mfe-types/src/navigation.ts
    - packages/mfe-types/src/dialog.ts
  </files>
  <action>
1. Delete existing `packages/mfe-types/dist/` and any stub source files
2. Create `packages/mfe-types/package.json`:
```json
{
  "name": "@packages/mfe-types",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "tsc -b",
    "dev": "tsc -b --watch"
  }
}
```
3. Create `packages/mfe-types/tsconfig.json`:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"]
}
```
4. Create `packages/mfe-types/src/mfe-registry.ts`:
```typescript
/**
 * Metadata for a registered MFE
 */
export interface MfeMetadata {
  /** Unique identifier for the MFE */
  id: string;
  /** Human-readable name */
  name: string;
  /** Routes this MFE handles */
  routes: string[];
  /** Semantic version */
  version: string;
  /** Required permissions to access (optional) */
  permissions?: string[];
  /** Whether MFE is enabled */
  enabled: boolean;
}

/**
 * Registry of all MFEs indexed by ID
 */
export interface MfeRegistry {
  [mfeId: string]: MfeMetadata;
}

/**
 * MFE loading state for UI feedback
 */
export type MfeLoadingState = 'idle' | 'loading' | 'loaded' | 'error';
```
5. Create `packages/mfe-types/src/auth.ts`:
```typescript
/**
 * User role for access control
 */
export type Role = 'admin' | 'agent' | 'manager' | 'viewer';

/**
 * Authenticated user information
 */
export interface User {
  id: string;
  username: string;
  role: Role;
}

/**
 * Auth store state interface (for Zustand)
 */
export interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
}

/**
 * Auth service interface for MFEs to consume
 */
export interface AuthService {
  /** Current auth state */
  getState: () => AuthState;
  /** Check if user has specific role */
  hasRole: (role: Role) => boolean;
  /** Check if user has any of the specified roles */
  hasAnyRole: (roles: Role[]) => boolean;
  /** Subscribe to auth changes */
  subscribe: (callback: (state: AuthState) => void) => () => void;
}
```
6. Create `packages/mfe-types/src/navigation.ts`:
```typescript
import type { ComponentType } from 'react';

/**
 * Navigation item in sidebar
 */
export interface NavigationItem {
  /** Unique identifier */
  id: string;
  /** Display label */
  label: string;
  /** Icon component */
  icon?: ComponentType<{ className?: string }>;
  /** Route path (for leaf items) */
  pathname?: string;
  /** Child items (for collapsible groups) */
  children?: NavigationItem[];
  /** Required roles to see this item */
  roles?: string[];
}

/**
 * Navigation group in sidebar
 */
export interface NavigationGroup {
  id: string;
  label: string;
  icon: ComponentType<{ className?: string }>;
  items: NavigationItem[];
  order: number;
}
```
7. Keep existing `packages/mfe-types/src/dialog.ts` if it exists, or create:
```typescript
import type { ComponentType } from 'react';

/**
 * Dialog component definition for registry
 */
export interface DialogDefinition<P = unknown> {
  id: string;
  component: ComponentType<P & { onClose: () => void }>;
}

/**
 * Global dialog state interface
 */
export interface DialogState {
  isOpen: boolean;
  dialogId: string | null;
  props: unknown;
}
```
8. Create `packages/mfe-types/src/index.ts`:
```typescript
// MFE Registry types
export type { MfeMetadata, MfeRegistry, MfeLoadingState } from './mfe-registry';

// Auth types
export type { Role, User, AuthState, AuthService } from './auth';

// Navigation types
export type { NavigationItem, NavigationGroup } from './navigation';

// Dialog types
export type { DialogDefinition, DialogState } from './dialog';
```
9. Run `pnpm --filter @packages/mfe-types build`
  </action>
  <verify>
- `pnpm --filter @packages/mfe-types build` succeeds
- `packages/mfe-types/dist/index.d.ts` exports all type definitions
- `cat packages/mfe-types/dist/mfe-registry.d.ts` shows MfeMetadata type
  </verify>
  <done>@packages/mfe-types built with complete type contracts for MFE-shell communication</done>
</task>

<task type="auto">
  <name>Task 2: Verify all packages build together and confirm mitt dependency</name>
  <files>
    - packages/event-bus/package.json (verify mitt)
  </files>
  <action>
1. Run `pnpm install` at root to ensure all dependencies installed
2. Run `pnpm -r build` to build all packages
3. Verify mitt is in event-bus dependencies (should have been added in Plan 01-02, Task 3)
4. Run `pnpm typecheck` to verify TypeScript project references work
5. Verify root tsconfig.json references are correct:
   - Check that all four packages are listed in references
   - Run `tsc -b --verbose` to see build order
  </action>
  <verify>
- `pnpm -r build` succeeds with all 4 packages
- `pnpm typecheck` (tsc -b) completes without errors
- Each package has dist/ with .js and .d.ts files
  </verify>
  <done>All shared packages build correctly with TypeScript project references</done>
</task>

</tasks>

<verification>
- `pnpm -r build` builds all packages
- `pnpm typecheck` passes
- `ls packages/*/dist/` shows output for all packages
</verification>

<success_criteria>
- @packages/mfe-types exports MfeMetadata, AuthService, NavigationItem types
- All four shared packages build successfully together
- TypeScript project references resolve correctly across packages
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure/01-03-SUMMARY.md`
</output>
