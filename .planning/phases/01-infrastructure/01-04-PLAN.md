---
phase: 01-infrastructure
plan: 04
type: execute
wave: 2
depends_on: ["01-02", "01-03"]
files_modified:
  - apps/shell/package.json
  - apps/shell/tsconfig.json
  - apps/shell/vite.config.ts
  - apps/shell/index.html
  - apps/shell/src/main.tsx
  - apps/shell/src/router.ts
  - apps/shell/src/routerContext.ts
  - apps/shell/src/vite-env.d.ts
autonomous: true

must_haves:
  truths:
    - "Shell app starts with pnpm --filter @apps/shell dev"
    - "Shell imports from @packages/* successfully"
    - "TanStack Router is configured with auto code splitting"
  artifacts:
    - path: "apps/shell/package.json"
      provides: "Shell app package config"
      contains: "@apps/shell"
    - path: "apps/shell/vite.config.ts"
      provides: "Vite config with TanStack Router"
      contains: "autoCodeSplitting"
    - path: "apps/shell/src/main.tsx"
      provides: "Shell entry point"
      contains: "RouterProvider"
  key_links:
    - from: "apps/shell/package.json"
      to: "@packages/ui"
      via: "workspace:*"
      pattern: '"@packages/ui".*workspace'
    - from: "apps/shell/tsconfig.json"
      to: "packages/ui"
      via: "project references"
      pattern: '"path".*packages/ui'
---

<objective>
Migrate existing src/ to apps/shell and configure as workspace package

Purpose: Transform the existing monolith into the shell app within the monorepo structure. This enables the shell to consume shared packages via workspace protocol.
Output: Working shell app that imports from @packages/* and runs with pnpm --filter @apps/shell dev
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure/01-RESEARCH.md
@.planning/phases/01-infrastructure/01-CONTEXT.md
@.planning/phases/01-infrastructure/01-02-SUMMARY.md
@.planning/phases/01-infrastructure/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shell package structure and migrate source</name>
  <files>
    - apps/shell/package.json
    - apps/shell/tsconfig.json
    - apps/shell/index.html
    - apps/shell/src/ (entire directory)
  </files>
  <action>
1. Create `apps/shell/package.json`:
```json
{
  "name": "@apps/shell",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@packages/ui": "workspace:*",
    "@packages/api-client": "workspace:*",
    "@packages/event-bus": "workspace:*",
    "@packages/mfe-types": "workspace:*",
    "@tanstack/react-query": "^5.90.17",
    "@tanstack/react-router": "^1.146.2",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.71.1",
    "@hookform/resolvers": "^5.2.2",
    "zod": "^4.3.5",
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@tanstack/router-plugin": "^1.147.3",
    "@tailwindcss/vite": "^4.1.18",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "tailwindcss": "^4.1.18",
    "typescript": "~5.9.3",
    "vite": "^7.2.4"
  }
}
```
2. Create `apps/shell/tsconfig.json`:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "types": ["vite/client"]
  },
  "references": [
    { "path": "../../packages/ui" },
    { "path": "../../packages/api-client" },
    { "path": "../../packages/event-bus" },
    { "path": "../../packages/mfe-types" }
  ],
  "include": ["src/**/*"]
}
```
3. Copy `index.html` from root to `apps/shell/index.html`
4. Move entire `src/` directory to `apps/shell/src/`
   - Keep all existing files: routes/, pages/, components/, store/, config/, etc.
5. Create `apps/shell/src/vite-env.d.ts`:
```typescript
/// <reference types="vite/client" />
```
6. Delete the now-empty root `src/` directory
7. Run `pnpm install` to link workspace packages
  </action>
  <verify>
- `apps/shell/package.json` exists with @packages/* workspace dependencies
- `apps/shell/src/` contains all source files
- Root `src/` directory no longer exists
- `pnpm install` succeeds
  </verify>
  <done>Shell app structure created with source migrated from root</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vite with TanStack Router auto code splitting</name>
  <files>
    - apps/shell/vite.config.ts
  </files>
  <action>
1. Create `apps/shell/vite.config.ts` (NOT moved from root, create fresh):
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import tailwindcss from '@tailwindcss/vite';
import { TanStackRouterVite } from '@tanstack/router-plugin/vite';
import path from 'path';

export default defineConfig({
  plugins: [
    TanStackRouterVite({
      autoCodeSplitting: true,
      routesDirectory: './src/routes',
      generatedRouteTree: './src/routeTree.gen.ts',
    }),
    react(),
    tailwindcss(),
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
    dedupe: ['react', 'react-dom', '@tanstack/react-query'],
  },
  optimizeDeps: {
    include: ['@packages/ui', '@packages/api-client', '@packages/event-bus'],
  },
});
```
2. Update `apps/shell/src/main.tsx` to import from workspace packages:
   - Change `import { queryClient } from "./lib/react-query/queryClient"` to `import { queryClient } from "@packages/api-client"`
   - Keep other imports that are shell-specific (useAuthStore, GlobalDialog, etc.)
3. Delete root `vite.config.ts` (shell has its own)
  </action>
  <verify>
- `apps/shell/vite.config.ts` exists with autoCodeSplitting enabled
- Root `vite.config.ts` deleted
  </verify>
  <done>Vite configured with TanStack Router auto code splitting</done>
</task>

<task type="auto">
  <name>Task 3: Update imports to use @packages/* and verify shell starts</name>
  <files>
    - apps/shell/src/main.tsx
    - apps/shell/src/lib/utils.ts
    - apps/shell/src/components/ui/* (update imports)
  </files>
  <action>
1. Update `apps/shell/src/main.tsx`:
```typescript
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { RouterProvider } from "@tanstack/react-router";
import { QueryClientProvider } from "@tanstack/react-query";
import { queryClient } from "@packages/api-client";
import useAuthStore from "./store/useAuthStore";
import { router } from "./router";
import GlobalDialog from "./components/dialogs/global-dialog";
import "./index.css";

function AppRouter() {
  const isLoggedIn = useAuthStore((state) => state.isLoggedIn);
  return (
    <RouterProvider
      router={router}
      context={{
        auth: {
          isLoggedIn,
        },
      }}
    />
  );
}

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <AppRouter />
      <GlobalDialog />
    </QueryClientProvider>
  </StrictMode>
);
```
2. Update `apps/shell/src/lib/utils.ts` to re-export from @packages/ui:
```typescript
export { cn } from "@packages/ui";
```
3. Keep existing components in `apps/shell/src/components/ui/` for now (they import from local utils)
   - These will be gradually replaced by @packages/ui imports in later plans
4. Delete `apps/shell/src/lib/react-query/` directory (now using @packages/api-client)
5. Delete `apps/shell/src/lib/api/` directory (now using @packages/api-client)
6. Run `pnpm --filter @apps/shell dev` to verify shell starts
7. Verify in browser that login page loads
  </action>
  <verify>
- `pnpm --filter @apps/shell dev` starts without errors
- Browser shows login page at http://localhost:5173
- Console shows no import errors for @packages/*
  </verify>
  <done>Shell app running with workspace package imports</done>
</task>

</tasks>

<verification>
- `pnpm --filter @apps/shell dev` starts dev server
- Browser loads login page successfully
- Network tab shows no 404s for JS modules
- `pnpm --filter @apps/shell build` produces dist/
</verification>

<success_criteria>
- Shell app migrated from root src/ to apps/shell/src/
- Shell imports @packages/api-client for queryClient
- TanStack Router configured with autoCodeSplitting
- Dev server starts and login page renders
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure/01-04-SUMMARY.md`
</output>
