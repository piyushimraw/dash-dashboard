---
phase: 02-mfe-migration
plan: 07
type: execute
wave: 3
depends_on: [02-01]
files_modified:
  - apps/mfe-return/package.json
  - apps/mfe-return/tsconfig.json
  - apps/mfe-return/src/index.ts
  - apps/mfe-return/src/ReturnPage.tsx
  - apps/mfe-return/src/forms/ReturnVehicleForm.tsx
  - apps/mfe-return/src/forms/return.schema.ts
  - apps/mfe-return/src/forms/return.types.ts
  - apps/shell/tsconfig.json
  - apps/shell/package.json
  - apps/shell/src/routes/_auth.return.tsx
autonomous: true

must_haves:
  truths:
    - "Return MFE package exists in apps/mfe-return/"
    - "ReturnVehicleForm uses @packages/ui form components (FormProvider, FormInput)"
    - "Form validation works with Zod schema"
    - "Shell return route imports from @apps/mfe-return"
  artifacts:
    - path: "apps/mfe-return/src/index.ts"
      provides: "ReturnPage export"
      exports: ["ReturnPage"]
    - path: "apps/mfe-return/src/ReturnPage.tsx"
      provides: "Return page with card layout and form"
      min_lines: 20
    - path: "apps/mfe-return/src/forms/ReturnVehicleForm.tsx"
      provides: "Return vehicle form with validation"
      min_lines: 40
  key_links:
    - from: "apps/mfe-return/src/forms/ReturnVehicleForm.tsx"
      to: "@packages/ui"
      via: "form component imports"
      pattern: "from '@packages/ui'"
    - from: "apps/shell/src/routes/_auth.return.tsx"
      to: "apps/mfe-return/src/index.ts"
      via: "workspace package import"
      pattern: "from '@apps/mfe-return'"
---

<objective>
Create mfe-return package with ReturnVehicleForm using @packages/ui form components.

Purpose: Return MFE follows the same pattern as rent MFE, demonstrating consistent form implementation across MFEs using shared components.

Output: Return MFE with working form validation using shared components
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mfe-migration/02-RESEARCH.md

# Prior plan - form components extracted
@.planning/phases/02-mfe-migration/02-01-SUMMARY.md

# Source files
@apps/shell/src/pages/ReturnPage.tsx
@apps/shell/src/forms/return/ReturnVehicleForm.tsx
@apps/shell/src/forms/return/return.schema.ts
@apps/shell/src/forms/return/return.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mfe-return package structure</name>
  <files>
    apps/mfe-return/package.json
    apps/mfe-return/tsconfig.json
    apps/mfe-return/src/index.ts
  </files>
  <action>
Create mfe-return package:

1. **apps/mfe-return/package.json**:
```json
{
  "name": "@apps/mfe-return",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "import": "./src/index.ts"
    }
  },
  "dependencies": {
    "@packages/ui": "workspace:*",
    "@packages/event-bus": "workspace:*",
    "@packages/mfe-types": "workspace:*"
  },
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.71.0",
    "@hookform/resolvers": "^5.2.0",
    "zod": "^4.0.0",
    "lucide-react": "^0.562.0"
  }
}
```

2. **apps/mfe-return/tsconfig.json**:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "noEmit": false
  },
  "references": [
    { "path": "../../packages/ui" },
    { "path": "../../packages/event-bus" },
    { "path": "../../packages/mfe-types" }
  ],
  "include": ["src"]
}
```

3. **apps/mfe-return/src/index.ts**:
```typescript
export { ReturnPage } from "./ReturnPage";
export type { ReturnVehicleFormValues } from "./forms/return.types";
```
  </action>
  <verify>
Directory apps/mfe-return/ created with package.json, tsconfig.json, src/index.ts
  </verify>
  <done>mfe-return package structure created</done>
</task>

<task type="auto">
  <name>Task 2: Migrate return page and form files</name>
  <files>
    apps/mfe-return/src/ReturnPage.tsx
    apps/mfe-return/src/forms/ReturnVehicleForm.tsx
    apps/mfe-return/src/forms/return.schema.ts
    apps/mfe-return/src/forms/return.types.ts
  </files>
  <action>
Copy and update return files:

1. **apps/mfe-return/src/forms/return.schema.ts** - Copy from shell as-is

2. **apps/mfe-return/src/forms/return.types.ts** - Copy from shell, create if not exists:
```typescript
import type { z } from "zod";
import { returnVehicleSchema } from "./return.schema";

export type ReturnVehicleFormValues = z.infer<typeof returnVehicleSchema>;
```

3. **apps/mfe-return/src/forms/ReturnVehicleForm.tsx** - Copy and update imports:
```typescript
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { Car, Calendar, MapPin, FileText } from "lucide-react";

import { FormProvider, FormInput, Button } from "@packages/ui";

import { returnVehicleSchema } from "./return.schema";
import type { ReturnVehicleFormValues } from "./return.types";

export function ReturnVehicleForm() {
  // ... existing implementation unchanged
}
```

Convert default export to named export.

4. **apps/mfe-return/src/ReturnPage.tsx** - Copy and update:
```typescript
import { ReturnVehicleForm } from "./forms/ReturnVehicleForm";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@packages/ui";
import { RotateCcw } from "lucide-react";

export function ReturnPage() {
  // ... existing JSX unchanged
}
```

Convert default export to named export.
  </action>
  <verify>
Files exist at apps/mfe-return/src/*.tsx and apps/mfe-return/src/forms/*.ts
  </verify>
  <done>Return page and form migrated with @packages/ui imports</done>
</task>

<task type="auto">
  <name>Task 3: Wire return MFE to shell</name>
  <files>
    apps/shell/tsconfig.json
    apps/shell/package.json
    apps/shell/src/routes/_auth.return.tsx
  </files>
  <action>
1. Update `apps/shell/tsconfig.json` to add mfe-return reference:
Add to references array: `{ "path": "../mfe-return" }`

2. Update `apps/shell/package.json` to add dependency:
Add to dependencies: `"@apps/mfe-return": "workspace:*"`

3. Update `apps/shell/src/routes/_auth.return.tsx`:
```typescript
import { requireRole } from '@/auth/requireRole'
import { MfeErrorBoundary } from '@/components/MfeErrorBoundary'
import { ROLES } from '@/config/roles'
import { ReturnPage } from '@apps/mfe-return'  // Changed from @/pages/ReturnPage
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/_auth/return')({
  beforeLoad: () =>
    requireRole([
      ROLES.SUPER_ADMIN,
      ROLES.COUNTER_AGENT
    ]),
  component: RouteComponent,
})

function RouteComponent() {
  return (
    <MfeErrorBoundary mfeName="Return">
      <ReturnPage />
    </MfeErrorBoundary>
  )
}
```

4. Run `pnpm install && pnpm --filter @apps/shell build`
  </action>
  <verify>
`pnpm install && pnpm --filter @apps/shell build` succeeds
  </verify>
  <done>Return MFE wired to shell, build passes</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @apps/shell build` passes
2. `pnpm --filter @apps/shell dev` - navigate to /return
3. Form renders in Card layout with all fields
4. Enter invalid data - validation errors appear
5. Fill valid data - form submits (check console log)
</verification>

<success_criteria>
- mfe-return package exists with ReturnPage and ReturnVehicleForm
- Form imports FormProvider, FormInput from @packages/ui
- Zod validation works correctly
- Shell return route imports from @apps/mfe-return
- Build passes, form renders and validates
</success_criteria>

<output>
After completion, create `.planning/phases/02-mfe-migration/02-07-SUMMARY.md`
</output>
