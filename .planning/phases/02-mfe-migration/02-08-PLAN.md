---
phase: 02-mfe-migration
plan: 08
type: execute
wave: 4
depends_on: [02-02]
files_modified:
  - apps/mfe-reservation-lookup/package.json
  - apps/mfe-reservation-lookup/tsconfig.json
  - apps/mfe-reservation-lookup/src/index.ts
  - apps/mfe-reservation-lookup/src/ReservationLookupPage.tsx
  - apps/mfe-reservation-lookup/src/features/rent-vehicle/api.ts
  - apps/mfe-reservation-lookup/src/features/rent-vehicle/query.ts
  - apps/mfe-reservation-lookup/src/hooks/useRentVehicleFilters.ts
  - apps/mfe-reservation-lookup/src/types/type.ts
  - apps/mfe-reservation-lookup/src/components/SearchComponent.tsx
  - apps/mfe-reservation-lookup/src/components/FiltersComponent.tsx
  - apps/mfe-reservation-lookup/src/components/HeaderComponent.tsx
  - apps/shell/tsconfig.json
  - apps/shell/package.json
  - apps/shell/src/routes/_auth.reservation_lookup.tsx
autonomous: true

must_haves:
  truths:
    - "Reservation Lookup MFE package exists in apps/mfe-reservation-lookup/"
    - "DataTable imports from @packages/ui"
    - "API queries use @packages/api-client queryKeys and http"
    - "Filters and search functionality work correctly"
    - "Shell reservation_lookup route imports from MFE package"
  artifacts:
    - path: "apps/mfe-reservation-lookup/src/index.ts"
      provides: "ReservationLookupPage export"
      exports: ["ReservationLookupPage"]
    - path: "apps/mfe-reservation-lookup/src/ReservationLookupPage.tsx"
      provides: "Table page with filters and search"
      min_lines: 100
    - path: "apps/mfe-reservation-lookup/src/features/rent-vehicle/query.ts"
      provides: "React Query hooks for data fetching"
      exports: ["useGetRentedVehicleList"]
  key_links:
    - from: "apps/mfe-reservation-lookup/src/ReservationLookupPage.tsx"
      to: "@packages/ui"
      via: "DataTable import"
      pattern: "from '@packages/ui'"
    - from: "apps/mfe-reservation-lookup/src/features/rent-vehicle/query.ts"
      to: "@packages/api-client"
      via: "queryKeys import"
      pattern: "from '@packages/api-client'"
---

<objective>
Create mfe-reservation-lookup package - the most complex MFE with DataTable, API queries, filters, and search.

Purpose: This MFE demonstrates full data-fetching integration with React Query, table rendering with @packages/ui DataTable, and local filtering state management.

Output: Reservation Lookup MFE with working table, filters, and search
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mfe-migration/02-RESEARCH.md

# Prior plan - DataTable extracted
@.planning/phases/02-mfe-migration/02-02-SUMMARY.md

# Source files
@apps/shell/src/pages/ReservationLookupPage.tsx
@apps/shell/src/features/rent-vehicle/api.ts
@apps/shell/src/features/rent-vehicle/query.ts
@apps/shell/src/hooks/useRentVehicleFilters.ts
@apps/shell/src/types/rent-vehicles/type.ts
@apps/shell/src/components/reservation-lookup-components/SearchComponent.tsx
@apps/shell/src/components/reservation-lookup-components/FiltersComponent.tsx
@apps/shell/src/components/reservation-lookup-components/HeaderComponent.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mfe-reservation-lookup package structure</name>
  <files>
    apps/mfe-reservation-lookup/package.json
    apps/mfe-reservation-lookup/tsconfig.json
    apps/mfe-reservation-lookup/src/index.ts
    apps/mfe-reservation-lookup/src/types/type.ts
  </files>
  <action>
Create mfe-reservation-lookup package:

1. **apps/mfe-reservation-lookup/package.json**:
```json
{
  "name": "@apps/mfe-reservation-lookup",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "import": "./src/index.ts"
    }
  },
  "dependencies": {
    "@packages/ui": "workspace:*",
    "@packages/api-client": "workspace:*",
    "@packages/event-bus": "workspace:*",
    "@packages/mfe-types": "workspace:*"
  },
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "@tanstack/react-query": "^5.90.0",
    "@tanstack/react-table": "^8.21.0",
    "lucide-react": "^0.562.0"
  }
}
```

2. **apps/mfe-reservation-lookup/tsconfig.json**:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "noEmit": false
  },
  "references": [
    { "path": "../../packages/ui" },
    { "path": "../../packages/api-client" },
    { "path": "../../packages/event-bus" },
    { "path": "../../packages/mfe-types" }
  ],
  "include": ["src"]
}
```

3. **apps/mfe-reservation-lookup/src/index.ts**:
```typescript
export { ReservationLookupPage } from "./ReservationLookupPage";
export type { TableType, FilterState } from "./types/type";
```

4. **apps/mfe-reservation-lookup/src/types/type.ts** - Copy from shell:
Copy `apps/shell/src/types/rent-vehicles/type.ts` content as-is
  </action>
  <verify>
Directory apps/mfe-reservation-lookup/ created with package structure
  </verify>
  <done>mfe-reservation-lookup package structure created with types</done>
</task>

<task type="auto">
  <name>Task 2: Migrate API, query, hooks, and components</name>
  <files>
    apps/mfe-reservation-lookup/src/features/rent-vehicle/api.ts
    apps/mfe-reservation-lookup/src/features/rent-vehicle/query.ts
    apps/mfe-reservation-lookup/src/hooks/useRentVehicleFilters.ts
    apps/mfe-reservation-lookup/src/components/SearchComponent.tsx
    apps/mfe-reservation-lookup/src/components/FiltersComponent.tsx
    apps/mfe-reservation-lookup/src/components/HeaderComponent.tsx
  </files>
  <action>
Copy supporting files from shell to MFE:

1. **apps/mfe-reservation-lookup/src/features/rent-vehicle/api.ts** - Copy from shell, keep @packages/api-client import:
```typescript
import { http } from "@packages/api-client";
// ... rest unchanged
```

2. **apps/mfe-reservation-lookup/src/features/rent-vehicle/query.ts** - Copy from shell:
```typescript
import { useQuery } from "@tanstack/react-query";
import { getRentedVehicleList } from "./api";
import { queryKeys } from "@packages/api-client";

export const useGetRentedVehicleList = () =>
  useQuery({
    queryKey: queryKeys.rentedVehicles.all,
    queryFn: getRentedVehicleList,
  });
```

3. **apps/mfe-reservation-lookup/src/hooks/useRentVehicleFilters.ts** - Copy and update type import:
```typescript
import type { FilterState, TableType } from "../types/type";
import { useMemo, useState } from "react";
// ... rest unchanged
```

4. **apps/mfe-reservation-lookup/src/components/SearchComponent.tsx** - Copy from shell
Update any @/ imports to relative paths or @packages/ui

5. **apps/mfe-reservation-lookup/src/components/FiltersComponent.tsx** - Copy from shell
Update imports to use @packages/ui for any UI components

6. **apps/mfe-reservation-lookup/src/components/HeaderComponent.tsx** - Copy from shell
Update imports to use @packages/ui for any UI components

Read each source file first to understand exact imports needed.
  </action>
  <verify>
All supporting files created in apps/mfe-reservation-lookup/src/
  </verify>
  <done>API, query, hooks, and components migrated</done>
</task>

<task type="auto">
  <name>Task 3: Migrate ReservationLookupPage and wire to shell</name>
  <files>
    apps/mfe-reservation-lookup/src/ReservationLookupPage.tsx
    apps/shell/tsconfig.json
    apps/shell/package.json
    apps/shell/src/routes/_auth.reservation_lookup.tsx
  </files>
  <action>
1. **apps/mfe-reservation-lookup/src/ReservationLookupPage.tsx** - Copy and update imports:
```typescript
import { DataTable } from "@packages/ui";
import type { ColumnDef } from "@tanstack/react-table";
import { useMemo } from "react";
import { useGetRentedVehicleList } from "./features/rent-vehicle/query";
import { FiltersComponent } from "./components/FiltersComponent";
import { SearchComponent } from "./components/SearchComponent";
import { HeaderComponent } from "./components/HeaderComponent";
import { useRentVehicleFilters } from "./hooks/useRentVehicleFilters";
import type { TableType } from "./types/type";

export function ReservationLookupPage() {
  // ... existing implementation unchanged
}
```

Convert default export to named export.

2. Update `apps/shell/tsconfig.json` to add reference:
Add: `{ "path": "../mfe-reservation-lookup" }`

3. Update `apps/shell/package.json` to add dependency:
Add: `"@apps/mfe-reservation-lookup": "workspace:*"`

4. Update `apps/shell/src/routes/_auth.reservation_lookup.tsx`:
```typescript
import { requireRole } from '@/auth/requireRole'
import { MfeErrorBoundary } from '@/components/MfeErrorBoundary'
import { ROLES } from '@/config/roles'
import { ReservationLookupPage } from '@apps/mfe-reservation-lookup'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/_auth/reservation_lookup')({
  beforeLoad: () =>
    requireRole([
      ROLES.SUPER_ADMIN,
      ROLES.COUNTER_AGENT,
      ROLES.FLEET_MANAGER
    ]),
  component: RouteComponent,
})

function RouteComponent() {
  return (
    <MfeErrorBoundary mfeName="Reservation Lookup">
      <ReservationLookupPage />
    </MfeErrorBoundary>
  )
}
```

5. Run `pnpm install && pnpm --filter @apps/shell build`
  </action>
  <verify>
`pnpm install && pnpm --filter @apps/shell build` succeeds
  </verify>
  <done>ReservationLookupPage migrated and wired to shell</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @apps/shell build` passes
2. `pnpm --filter @apps/shell dev` - navigate to /reservation_lookup
3. Table renders (may show "No Data Found" if no mock data)
4. Search input filters data
5. Filters panel opens and filters work
6. Table sorting works (click column headers)
</verification>

<success_criteria>
- mfe-reservation-lookup package exists with all components
- DataTable imports from @packages/ui
- Query hook uses @packages/api-client queryKeys
- Shell reservation_lookup route imports from MFE
- Build passes, table renders with full functionality
</success_criteria>

<output>
After completion, create `.planning/phases/02-mfe-migration/02-08-SUMMARY.md`
</output>
