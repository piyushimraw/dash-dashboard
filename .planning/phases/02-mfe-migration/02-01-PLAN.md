---
phase: 02-mfe-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/ui/src/index.ts
  - packages/ui/src/components/form/FormProvider.tsx
  - packages/ui/src/components/form/FormInput.tsx
  - packages/ui/src/components/form/FormSelect.tsx
  - packages/ui/src/components/form/FormError.tsx
  - packages/ui/package.json
autonomous: true

must_haves:
  truths:
    - "Form components can be imported from @packages/ui by MFE packages"
    - "FormProvider wraps react-hook-form and renders a form element"
    - "FormInput renders labeled input with validation error display"
    - "FormSelect renders labeled select dropdown with validation error display"
  artifacts:
    - path: "packages/ui/src/components/form/FormProvider.tsx"
      provides: "Form context provider wrapping react-hook-form"
      exports: ["FormProvider"]
    - path: "packages/ui/src/components/form/FormInput.tsx"
      provides: "Controlled input with label and error display"
      exports: ["FormInput"]
    - path: "packages/ui/src/components/form/FormSelect.tsx"
      provides: "Controlled select with label and error display"
      exports: ["FormSelect"]
    - path: "packages/ui/src/components/form/FormError.tsx"
      provides: "Error message display component"
      exports: ["FormError"]
  key_links:
    - from: "packages/ui/src/index.ts"
      to: "packages/ui/src/components/form/*.tsx"
      via: "barrel exports"
      pattern: "export.*from.*form"
---

<objective>
Extract form components (FormProvider, FormInput, FormSelect, FormError) from shell to @packages/ui for reuse across MFE packages.

Purpose: MFEs with forms (mfe-rent, mfe-return) need shared form components. Extracting to @packages/ui enables consistent form UX across MFEs without duplication.

Output: Form components available via `import { FormProvider, FormInput, FormSelect } from '@packages/ui'`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mfe-migration/02-RESEARCH.md

# Source files to extract
@apps/shell/src/components/form/FormProvider.tsx
@apps/shell/src/components/form/FormInput.tsx
@apps/shell/src/components/form/FormSelect.tsx
@apps/shell/src/components/form/FormError.tsx

# Target package
@packages/ui/src/index.ts
@packages/ui/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy form components to @packages/ui</name>
  <files>
    packages/ui/src/components/form/FormProvider.tsx
    packages/ui/src/components/form/FormInput.tsx
    packages/ui/src/components/form/FormSelect.tsx
    packages/ui/src/components/form/FormError.tsx
  </files>
  <action>
Create `packages/ui/src/components/form/` directory and copy form components from shell, updating imports:

1. **FormError.tsx** - Copy as-is, it has no external dependencies beyond React types

2. **FormInput.tsx** - Update imports:
   - Change `import { Label } from "../ui/label"` to `import { Label } from "../label"`
   - Change `import { Input } from "../ui/input"` to `import { Input } from "../input"`
   - Change `import FormError from "./FormError"` to relative import

3. **FormSelect.tsx** - Update imports:
   - Change `import { Label } from "../ui/label"` to `import { Label } from "../label"`
   - Change `import FormError from "./FormError"` to relative import
   - Keep lucide-react import (already in package deps)

4. **FormProvider.tsx** - Copy as-is (only depends on react-hook-form types)

All components should use named exports (not default) for consistency with @packages/ui patterns.
  </action>
  <verify>
Files exist at packages/ui/src/components/form/*.tsx
  </verify>
  <done>Four form components created in packages/ui with correct internal imports</done>
</task>

<task type="auto">
  <name>Task 2: Update @packages/ui exports and dependencies</name>
  <files>
    packages/ui/src/index.ts
    packages/ui/package.json
  </files>
  <action>
1. **packages/ui/src/index.ts** - Add form component exports:
```typescript
// Form Components
export { FormProvider } from "./components/form/FormProvider";
export { FormInput } from "./components/form/FormInput";
export { FormSelect } from "./components/form/FormSelect";
export { FormError } from "./components/form/FormError";
```

2. **packages/ui/package.json** - Add react-hook-form as peer dependency (form components use useFormContext):
```json
"peerDependencies": {
  "react": "^19.0.0",
  "react-dom": "^19.0.0",
  "react-hook-form": "^7.71.0"
}
```

Note: Do NOT add react-hook-form as a regular dependency - it must be a peer dependency to avoid duplicate instances between shell and packages.
  </action>
  <verify>
Run `pnpm --filter @packages/ui build` - should complete without TypeScript errors
  </verify>
  <done>@packages/ui exports form components and declares react-hook-form as peer dependency</done>
</task>

<task type="auto">
  <name>Task 3: Verify form components importable from @packages/ui</name>
  <files>
    packages/ui/src/index.ts
  </files>
  <action>
Verify the form components are correctly exported and the package builds successfully.

Run `pnpm --filter @packages/ui build` to confirm:
- TypeScript compiles without errors
- All form components are properly exported
- No missing dependencies

This task verifies the extraction is complete. The actual shell form migration to use @packages/ui imports will happen in plans 02-06 (mfe-rent) and 02-07 (mfe-return) when forms are moved to their respective MFE packages. Shell's local form components remain in place until those plans execute.

Note: This is intentional - we extract to @packages/ui first, then the MFE migration plans (02-06, 02-07) will create forms that import from @packages/ui. Shell cleanup happens in 02-09.
  </action>
  <verify>
Run `pnpm --filter @packages/ui build` - build passes with form component exports
  </verify>
  <done>Form components extracted to @packages/ui and verified buildable</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @packages/ui build` passes
2. Form components exist at packages/ui/src/components/form/*.tsx
3. packages/ui/src/index.ts exports FormProvider, FormInput, FormSelect, FormError
</verification>

<success_criteria>
- Form components extracted to packages/ui/src/components/form/
- @packages/ui exports FormProvider, FormInput, FormSelect, FormError
- @packages/ui build passes
- Form components ready for MFE packages to import (actual usage in 02-06, 02-07)
</success_criteria>

<output>
After completion, create `.planning/phases/02-mfe-migration/02-01-SUMMARY.md`
</output>
