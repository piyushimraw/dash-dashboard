---
phase: 02-mfe-migration
plan: 05
type: execute
wave: 3
depends_on: [02-03]
files_modified:
  - apps/mfe-dashboard/package.json
  - apps/mfe-dashboard/tsconfig.json
  - apps/mfe-dashboard/src/index.ts
  - apps/mfe-dashboard/src/DashboardPage.tsx
  - apps/shell/tsconfig.json
  - apps/shell/package.json
  - apps/shell/src/routes/_auth.dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard MFE package exists in apps/mfe-dashboard/"
    - "DashboardPage uses @packages/ui Card and Button components"
    - "Dashboard quick actions navigate using TanStack Router useNavigate"
    - "Shell dashboard route imports from @apps/mfe-dashboard"
  artifacts:
    - path: "apps/mfe-dashboard/src/index.ts"
      provides: "DashboardPage export"
      exports: ["DashboardPage"]
    - path: "apps/mfe-dashboard/src/DashboardPage.tsx"
      provides: "Dashboard with quick actions"
      min_lines: 80
  key_links:
    - from: "apps/shell/src/routes/_auth.dashboard.tsx"
      to: "apps/mfe-dashboard/src/index.ts"
      via: "workspace package import"
      pattern: "from '@apps/mfe-dashboard'"
    - from: "apps/mfe-dashboard/src/DashboardPage.tsx"
      to: "@packages/ui"
      via: "UI component imports"
      pattern: "from '@packages/ui'"
---

<objective>
Create mfe-dashboard package and migrate DashboardPage with navigation functionality using TanStack Router.

Purpose: Dashboard is a medium-complexity MFE that demonstrates using @packages/ui components. It has quick action buttons that navigate to other MFEs using the shell's router context.

Output: Dashboard MFE package that uses shared UI and router navigation
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mfe-migration/02-RESEARCH.md

# Source page
@apps/shell/src/pages/DashboardPage.tsx

# Shell configuration
@apps/shell/tsconfig.json
@apps/shell/package.json

# Event bus for navigation
@packages/event-bus/src/events.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mfe-dashboard package structure</name>
  <files>
    apps/mfe-dashboard/package.json
    apps/mfe-dashboard/tsconfig.json
    apps/mfe-dashboard/src/index.ts
  </files>
  <action>
Create mfe-dashboard package:

1. **apps/mfe-dashboard/package.json**:
```json
{
  "name": "@apps/mfe-dashboard",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "import": "./src/index.ts"
    }
  },
  "dependencies": {
    "@packages/ui": "workspace:*",
    "@packages/event-bus": "workspace:*",
    "@packages/mfe-types": "workspace:*"
  },
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "@tanstack/react-router": "^1.146.0",
    "lucide-react": "^0.562.0"
  }
}
```

2. **apps/mfe-dashboard/tsconfig.json**:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "noEmit": false
  },
  "references": [
    { "path": "../../packages/ui" },
    { "path": "../../packages/event-bus" },
    { "path": "../../packages/mfe-types" }
  ],
  "include": ["src"]
}
```

3. **apps/mfe-dashboard/src/index.ts**:
```typescript
export { DashboardPage } from "./DashboardPage";
```
  </action>
  <verify>
Directory apps/mfe-dashboard/ created with package.json, tsconfig.json, src/index.ts
  </verify>
  <done>mfe-dashboard package structure created</done>
</task>

<task type="auto">
  <name>Task 2: Migrate DashboardPage with @packages/ui imports</name>
  <files>
    apps/mfe-dashboard/src/DashboardPage.tsx
  </files>
  <action>
Create DashboardPage.tsx in mfe-dashboard, updating imports to use @packages/ui:

1. Copy content from `apps/shell/src/pages/DashboardPage.tsx`

2. Update imports:
```typescript
import { Card, CardContent, CardHeader, CardTitle, Button } from "@packages/ui";
import {
  Car,
  ClipboardList,
  ArrowRightLeft,
  TrendingUp,
  ChevronRight,
} from "lucide-react";
import { useNavigate } from "@tanstack/react-router";
```

3. Convert to named export:
```typescript
export function DashboardPage() {
  // ... existing implementation
}
```

4. Keep the existing quick actions array and navigation logic using useNavigate

Note: The dashboard uses useNavigate from @tanstack/react-router for navigation. This is acceptable as it's a peer dependency and the shell provides the router context.
  </action>
  <verify>
File exists at apps/mfe-dashboard/src/DashboardPage.tsx with @packages/ui imports
  </verify>
  <done>DashboardPage migrated with @packages/ui components</done>
</task>

<task type="auto">
  <name>Task 3: Wire dashboard MFE to shell route</name>
  <files>
    apps/shell/tsconfig.json
    apps/shell/package.json
    apps/shell/src/routes/_auth.dashboard.tsx
  </files>
  <action>
1. Update `apps/shell/tsconfig.json` to add mfe-dashboard reference:
```json
"references": [
  { "path": "../../packages/ui" },
  { "path": "../../packages/api-client" },
  { "path": "../../packages/mfe-types" },
  { "path": "../mfe-settings" },
  { "path": "../mfe-reports" },
  { "path": "../mfe-aao" },
  { "path": "../mfe-car-control" },
  { "path": "../mfe-vehicle-exchange" },
  { "path": "../mfe-dashboard" }
]
```

2. Update `apps/shell/package.json` to add dependency:
```json
"dependencies": {
  "@apps/mfe-dashboard": "workspace:*",
  // ... existing deps
}
```

3. Update `apps/shell/src/routes/_auth.dashboard.tsx`:
```typescript
import { MfeErrorBoundary } from "@/components/MfeErrorBoundary";
import { DashboardPage } from "@apps/mfe-dashboard";  // Changed from @/pages/DashboardPage
import { createFileRoute } from "@tanstack/react-router";

export const Route = createFileRoute("/_auth/dashboard")({
  component: RouteComponent,
});

function RouteComponent() {
  return (
    <MfeErrorBoundary mfeName="Dashboard">
      <DashboardPage />
    </MfeErrorBoundary>
  );
}
```

4. Run `pnpm install` to link the new package

5. Run `pnpm --filter @apps/shell build` to verify
  </action>
  <verify>
`pnpm install && pnpm --filter @apps/shell build` succeeds, dashboard route uses MFE import
  </verify>
  <done>Dashboard MFE wired to shell route, build passes</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @apps/shell build` passes
2. `pnpm --filter @apps/shell dev` starts
3. Navigate to /dashboard - quick actions render
4. Click quick action buttons - navigates to correct routes
5. No duplicate React or router errors in console
</verification>

<success_criteria>
- mfe-dashboard package exists with DashboardPage component
- DashboardPage imports UI components from @packages/ui
- Shell dashboard route imports from @apps/mfe-dashboard
- Quick action navigation works correctly
- Build passes, no runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-mfe-migration/02-05-SUMMARY.md`
</output>
