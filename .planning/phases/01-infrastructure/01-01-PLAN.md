---
phase: 01-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pnpm-workspace.yaml
  - package.json
  - tsconfig.base.json
  - tsconfig.json
  - .npmrc
autonomous: true

must_haves:
  truths:
    - "pnpm install resolves workspace packages without errors"
    - "TypeScript can check types across packages without errors"
    - "Path aliases resolve correctly in IDE and at build time"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "Workspace definition"
      contains: "packages/*"
    - path: "tsconfig.base.json"
      provides: "Shared TypeScript options"
      contains: "composite"
    - path: "tsconfig.json"
      provides: "Project references root"
      contains: "references"
  key_links:
    - from: "tsconfig.json"
      to: "packages/*/tsconfig.json"
      via: "project references"
      pattern: '"path".*packages'
---

<objective>
Establish pnpm workspace monorepo foundation with TypeScript project references

Purpose: Create the monorepo infrastructure that all packages and apps will build upon. This is the foundation for parallel development across shared packages and MFEs.
Output: Working pnpm workspace with TypeScript project references enabling cross-package type checking
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure/01-RESEARCH.md
@.planning/phases/01-infrastructure/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize pnpm workspace and migrate from npm</name>
  <files>
    - pnpm-workspace.yaml
    - package.json
    - .npmrc
  </files>
  <action>
1. Delete `package-lock.json` (will be replaced by pnpm-lock.yaml)
2. Create `pnpm-workspace.yaml`:
```yaml
packages:
  - 'packages/*'
  - 'apps/*'
```
3. Create `.npmrc` for pnpm configuration:
```
shamefully-hoist=false
strict-peer-dependencies=true
auto-install-peers=true
```
4. Update root `package.json`:
   - Ensure `"private": true` is set
   - Move ALL production dependencies to devDependencies (root is workspace only)
   - Add workspace scripts:
     - `"dev": "pnpm --filter @apps/shell dev"`
     - `"build": "pnpm -r build"`
     - `"typecheck": "tsc -b"`
     - `"lint": "eslint ."`
5. Run `pnpm install` to generate pnpm-lock.yaml
  </action>
  <verify>
- `pnpm install` completes without errors
- `pnpm-lock.yaml` exists
- `pnpm list` shows workspace packages
  </verify>
  <done>pnpm workspace initialized with packages/* and apps/* configured</done>
</task>

<task type="auto">
  <name>Task 2: Configure TypeScript project references</name>
  <files>
    - tsconfig.base.json
    - tsconfig.json
    - tsconfig.app.json (delete)
    - tsconfig.node.json (delete)
  </files>
  <action>
1. Create `tsconfig.base.json` (shared options, NOT extended by root):
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "jsx": "react-jsx",
    "strict": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "noEmit": false,
    "declaration": true,
    "declarationMap": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  }
}
```
2. Update root `tsconfig.json` (references only, NO include):
```json
{
  "files": [],
  "references": [
    { "path": "./packages/ui" },
    { "path": "./packages/api-client" },
    { "path": "./packages/event-bus" },
    { "path": "./packages/mfe-types" },
    { "path": "./apps/shell" }
  ]
}
```
3. Delete `tsconfig.app.json` and `tsconfig.node.json` (legacy from non-monorepo setup)
4. The old `src/` directory will be migrated to `apps/shell/src/` in Plan 03

NOTE: Do NOT create package-level tsconfigs yet - those are created in Plans 02 and 03 when the packages are set up.
  </action>
  <verify>
- `cat tsconfig.base.json` shows composite-ready options
- `cat tsconfig.json` shows only references, no include
- tsconfig.app.json and tsconfig.node.json are deleted
  </verify>
  <done>TypeScript project references structure established at root level</done>
</task>

</tasks>

<verification>
- `pnpm install` succeeds
- `pnpm list -r` shows workspace packages recognized
- TypeScript base config ready for packages to extend
</verification>

<success_criteria>
- pnpm workspace active with packages/* and apps/* globs
- TypeScript project references root configured
- No npm artifacts remaining (package-lock.json deleted)
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure/01-01-SUMMARY.md`
</output>
