---
phase: 01-infrastructure
plan: 06
type: execute
wave: 3
depends_on: ["01-04", "01-05"]
files_modified:
  - apps/shell/src/components/layout/Header.tsx
  - apps/shell/src/components/layout/Footer.tsx
  - apps/shell/src/components/layout/Sidebar.tsx
  - apps/shell/src/components/layout/index.ts
  - apps/shell/src/routes/_auth.tsx
autonomous: true

must_haves:
  truths:
    - "Layout renders consistently across all authenticated routes"
    - "Sidebar collapses to icon-only rail on desktop"
    - "Sidebar is hamburger drawer on mobile"
    - "Header shows breadcrumbs and user info"
  artifacts:
    - path: "apps/shell/src/components/layout/Header.tsx"
      provides: "Shell header component"
      contains: "breadcrumbs"
    - path: "apps/shell/src/components/layout/Sidebar.tsx"
      provides: "Collapsible sidebar component"
      contains: "collapsed"
    - path: "apps/shell/src/components/layout/Footer.tsx"
      provides: "Shell footer component"
      min_lines: 10
  key_links:
    - from: "apps/shell/src/routes/_auth.tsx"
      to: "layout components"
      via: "imports and renders"
      pattern: "import.*layout"
---

<objective>
Extract and enhance layout components (sidebar, header, footer) with collapsible sidebar

Purpose: Provide consistent shell chrome that wraps all MFE content. The layout establishes visual consistency and navigation patterns across the entire application.
Output: Collapsible sidebar (icon-only rail on desktop, hamburger drawer on mobile), header with breadcrumbs, footer
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure/01-RESEARCH.md
@.planning/phases/01-infrastructure/01-CONTEXT.md
@.planning/phases/01-infrastructure/01-04-SUMMARY.md
@.planning/phases/01-infrastructure/01-05-SUMMARY.md

# Existing sidebar for reference
@apps/shell/src/components/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create layout directory and extract header/footer components</name>
  <files>
    - apps/shell/src/components/layout/Header.tsx
    - apps/shell/src/components/layout/Footer.tsx
    - apps/shell/src/components/layout/index.ts
  </files>
  <action>
1. Create `apps/shell/src/components/layout/` directory
2. Create `apps/shell/src/components/layout/Header.tsx`:
```typescript
import { Button } from '@packages/ui';
import { Menu } from 'lucide-react';
import { useLocation, useMatches } from '@tanstack/react-router';
import useAuthStore from '../../store/useAuthStore';
import { useMemo } from 'react';

interface HeaderProps {
  onMenuClick: () => void;
  sidebarOpen: boolean;
}

export function Header({ onMenuClick, sidebarOpen }: HeaderProps) {
  const { userId } = useAuthStore();
  const location = useLocation();
  const matches = useMatches();

  // Generate breadcrumbs from route matches (max 3 levels)
  const breadcrumbs = useMemo(() => {
    const crumbs = matches
      .filter((match) => match.pathname !== '/' && match.pathname !== '/_auth')
      .map((match) => ({
        label: match.pathname
          .split('/')
          .pop()
          ?.replace(/[_-]/g, ' ')
          .replace(/\b\w/g, (c) => c.toUpperCase()) || '',
        path: match.pathname,
      }))
      .slice(-3); // Max 3 breadcrumbs

    return crumbs;
  }, [matches]);

  // Page title from current route
  const pageTitle = useMemo(() => {
    const pathname = location.pathname;
    return pathname
      .replace(/[^a-zA-Z0-9 ]/g, ' ')
      .trim()
      .toLowerCase()
      .replace(/\b\w/g, (char) => char.toUpperCase()) || 'Dashboard';
  }, [location.pathname]);

  return (
    <header className="h-14 sm:h-16 border-b bg-white/80 backdrop-blur-sm flex items-center justify-between px-4 sm:px-6 flex-shrink-0">
      <div className="flex items-center gap-3">
        <Button
          variant="ghost"
          size="icon"
          className="lg:hidden min-h-[44px] min-w-[44px]"
          onClick={onMenuClick}
          aria-label="Open navigation menu"
          aria-expanded={sidebarOpen}
          aria-controls="main-sidebar"
        >
          <Menu className="h-5 w-5" aria-hidden="true" />
        </Button>
        <div>
          <div className="flex items-center gap-2 text-sm text-muted-foreground">
            {breadcrumbs.map((crumb, index) => (
              <span key={crumb.path} className="flex items-center gap-2">
                {index > 0 && <span>/</span>}
                <span className={index === breadcrumbs.length - 1 ? 'text-foreground font-medium' : ''}>
                  {crumb.label}
                </span>
              </span>
            ))}
          </div>
          <h1 className="text-lg sm:text-xl font-bold text-foreground">
            {pageTitle}
          </h1>
          <p className="text-xs sm:text-sm text-muted-foreground hidden sm:block">
            Welcome back{' '}
            <span className="text-yellow-500 font-medium px-1">{userId}</span>!
            Here's your overview.
          </p>
        </div>
      </div>
      <div className="flex items-center gap-2 sm:gap-4">
        <div className="hidden sm:flex items-center gap-3 pl-4 border-l">
          <div className="text-right">
            <p className="text-sm font-medium">GEHDOFF / 01</p>
            <p className="text-xs text-muted-foreground">CASFO15</p>
          </div>
        </div>
      </div>
    </header>
  );
}
```
3. Create `apps/shell/src/components/layout/Footer.tsx`:
```typescript
import { Card, CardContent } from '@packages/ui';

export function Footer() {
  return (
    <footer className="flex-shrink-0">
      <Card className="w-full bg-tan/30 border-tan-dark/30 rounded-xs">
        <CardContent className="p-4 text-center">
          <p className="text-xs sm:text-sm font-medium text-foreground">
            Copyright (c) 2003 The Hertz Corporation - All Rights Reserved
          </p>
          <p className="text-xs text-muted-foreground mt-1 max-w-2xl mx-auto">
            The information contained herein is confidential and proprietary.
            Unauthorized use, duplication or disclosure is prohibited by law.
          </p>
        </CardContent>
      </Card>
    </footer>
  );
}
```
4. Create `apps/shell/src/components/layout/index.ts`:
```typescript
export { Header } from './Header';
export { Footer } from './Footer';
export { Sidebar } from './Sidebar';
```
  </action>
  <verify>
- `apps/shell/src/components/layout/Header.tsx` exists with breadcrumbs
- `apps/shell/src/components/layout/Footer.tsx` exists
- `apps/shell/src/components/layout/index.ts` exports all components
  </verify>
  <done>Header and Footer layout components created with breadcrumb support</done>
</task>

<task type="auto">
  <name>Task 2: Move and enhance Sidebar with collapsible rail behavior</name>
  <files>
    - apps/shell/src/components/layout/Sidebar.tsx
    - apps/shell/src/components/Sidebar.tsx (delete after move)
  </files>
  <action>
1. Move `apps/shell/src/components/Sidebar.tsx` to `apps/shell/src/components/layout/Sidebar.tsx`
2. Enhance the Sidebar to support collapsible rail on desktop:
```typescript
// Add to existing imports
import { useState, useEffect } from 'react';

// Add collapsed state with localStorage persistence
const [collapsed, setCollapsed] = useState(() => {
  if (typeof window === 'undefined') return false;
  return localStorage.getItem('sidebar-collapsed') === 'true';
});

useEffect(() => {
  localStorage.setItem('sidebar-collapsed', String(collapsed));
}, [collapsed]);

// Update sidebar width classes:
// When collapsed: w-16 (icon-only rail)
// When expanded: w-64
// On mobile (lg:hidden): full drawer behavior unchanged

// Update the aside className:
className={cn(
  "h-screen no-scrollbar fixed lg:static inset-y-0 top-0 left-0 z-50 bg-sidebar flex flex-col shadow-xl transition-all duration-300",
  // Mobile: always full width drawer
  isOpen ? "translate-x-0" : "-translate-x-full",
  "lg:translate-x-0",
  // Desktop: collapsible rail
  collapsed ? "lg:w-16" : "lg:w-64"
)}

// Add collapse toggle button in header (desktop only):
<Button
  variant="ghost"
  size="icon"
  className="hidden lg:flex"
  onClick={() => setCollapsed(!collapsed)}
  aria-label={collapsed ? "Expand sidebar" : "Collapse sidebar"}
>
  <ChevronLeft className={cn("h-4 w-4 transition-transform", collapsed && "rotate-180")} />
</Button>

// Update menu items to show only icons when collapsed:
{!collapsed && <span>{item.label}</span>}

// Add hover expand behavior (optional enhancement):
// On hover when collapsed, show tooltip with label
```
3. Update component props interface if needed
4. Delete the old `apps/shell/src/components/Sidebar.tsx` file
5. Update any imports in other files that reference the old location
  </action>
  <verify>
- Sidebar is in `apps/shell/src/components/layout/Sidebar.tsx`
- Old Sidebar.tsx deleted
- Collapse button visible on desktop
- Collapsed state persists in localStorage
  </verify>
  <done>Sidebar moved to layout/ with collapsible rail behavior on desktop</done>
</task>

<task type="auto">
  <name>Task 3: Update _auth layout to use extracted layout components</name>
  <files>
    - apps/shell/src/routes/_auth.tsx
  </files>
  <action>
1. Update `apps/shell/src/routes/_auth.tsx` to use layout components:
```typescript
import { Header, Footer, Sidebar } from '../components/layout';
import { Outlet, createFileRoute, redirect, useNavigate } from '@tanstack/react-router';
import useAuthStore from '../store/useAuthStore';
import { useState } from 'react';

export const Route = createFileRoute('/_auth')({
  beforeLoad: ({ context, location }) => {
    if (!context.auth.isLoggedIn) {
      throw redirect({
        to: '/login',
        search: {
          redirect: location.href,
        },
      });
    }
  },
  component: AuthLayout,
});

function AuthLayout() {
  const navigate = useNavigate();
  const { logout } = useAuthStore();
  const [sidebarOpen, setSidebarOpen] = useState(false);

  const handleLogout = () => {
    logout();
    navigate({ to: '/login' });
  };

  return (
    <div className="h-dvh w-full bg-background flex">
      <Sidebar
        onLogout={handleLogout}
        isOpen={sidebarOpen}
        onClose={() => setSidebarOpen(false)}
      />

      {/* Main Content */}
      <div className="flex-1 flex flex-col overflow-hidden">
        <Header
          onMenuClick={() => setSidebarOpen(true)}
          sidebarOpen={sidebarOpen}
        />

        {/* Scrollable content area */}
        <div className="flex-1 overflow-y-auto flex flex-col">
          <main className="flex-1 p-4 sm:p-6 space-y-4 sm:space-y-6">
            <Outlet />
          </main>

          <Footer />
        </div>
      </div>
    </div>
  );
}
```
2. Remove duplicate layout code that was inline in _auth.tsx
3. Verify the layout renders correctly
  </action>
  <verify>
- `apps/shell/src/routes/_auth.tsx` imports from `../components/layout`
- Layout renders correctly with sidebar, header, and footer
- Mobile hamburger menu works
- Desktop collapse toggle works
  </verify>
  <done>Auth layout uses extracted layout components</done>
</task>

</tasks>

<verification>
- `pnpm --filter @apps/shell dev` starts successfully
- Navigate to authenticated routes - layout renders consistently
- Desktop: Click collapse button - sidebar shrinks to icon-only
- Mobile: Click hamburger - drawer slides in
- Breadcrumbs show in header based on current route
</verification>

<success_criteria>
- Layout components extracted to apps/shell/src/components/layout/
- Sidebar collapses to icon-only rail on desktop (persisted)
- Sidebar is hamburger drawer on mobile
- Header shows breadcrumbs (max 3 levels)
- Footer renders at bottom of scrollable area
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure/01-06-SUMMARY.md`
</output>
