---
phase: 01-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/ui/package.json
  - packages/ui/tsconfig.json
  - packages/ui/src/index.ts
  - packages/api-client/package.json
  - packages/api-client/tsconfig.json
  - packages/api-client/src/index.ts
  - packages/event-bus/package.json
  - packages/event-bus/tsconfig.json
  - packages/event-bus/src/index.ts
  - packages/mfe-types/package.json
  - packages/mfe-types/tsconfig.json
  - packages/mfe-types/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Each shared package builds independently with tsc"
    - "Packages can be imported by shell using workspace protocol"
    - "TypeScript types are exported correctly from each package"
  artifacts:
    - path: "packages/ui/package.json"
      provides: "UI component library package config"
      contains: "@packages/ui"
    - path: "packages/api-client/package.json"
      provides: "API client package config"
      contains: "@packages/api-client"
    - path: "packages/event-bus/package.json"
      provides: "Event bus package config"
      contains: "@packages/event-bus"
    - path: "packages/mfe-types/package.json"
      provides: "MFE type contracts package config"
      contains: "@packages/mfe-types"
  key_links:
    - from: "packages/*/tsconfig.json"
      to: "tsconfig.base.json"
      via: "extends"
      pattern: "extends.*tsconfig.base.json"
---

<objective>
Create and configure the four shared packages: @packages/ui, @packages/api-client, @packages/event-bus, @packages/mfe-types

Purpose: Establish the shared packages that all MFEs and shell will depend on. These packages enforce clean boundaries and enable type-safe contracts.
Output: Four buildable packages with proper TypeScript composite configuration

Note: Import wiring (shell importing from workspace packages) is verified in Plan 01-04, not in this plan. This plan focuses only on package creation and standalone build verification.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure/01-RESEARCH.md
@.planning/phases/01-infrastructure/01-CONTEXT.md
@.planning/phases/01-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up @packages/ui with extracted Radix components</name>
  <files>
    - packages/ui/package.json
    - packages/ui/tsconfig.json
    - packages/ui/src/index.ts
    - packages/ui/src/components/button.tsx
    - packages/ui/src/components/card.tsx
    - packages/ui/src/components/dialog.tsx
    - packages/ui/src/components/input.tsx
    - packages/ui/src/components/label.tsx
    - packages/ui/src/components/collapsible.tsx
    - packages/ui/src/components/separator.tsx
    - packages/ui/src/components/sheet.tsx
    - packages/ui/src/lib/utils.ts
  </files>
  <action>
1. Remove existing stub directories (packages/shared-ui, packages/shared-utils, packages/shared-state) - we're consolidating into @packages/ui
2. Create `packages/ui/package.json`:
```json
{
  "name": "@packages/ui",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    },
    "./lib/utils": {
      "types": "./dist/lib/utils.d.ts",
      "import": "./dist/lib/utils.js"
    }
  },
  "scripts": {
    "build": "tsc -b",
    "dev": "tsc -b --watch"
  },
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0"
  },
  "dependencies": {
    "@radix-ui/react-collapsible": "^1.1.12",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.8",
    "@radix-ui/react-separator": "^1.1.8",
    "@radix-ui/react-slot": "^1.2.4",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "tailwind-merge": "^3.4.0",
    "lucide-react": "^0.562.0"
  }
}
```
3. Create `packages/ui/tsconfig.json`:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "baseUrl": ".",
    "paths": {
      "@ui/*": ["./src/*"]
    }
  },
  "include": ["src/**/*"]
}
```
4. Copy UI components from `src/components/ui/*` to `packages/ui/src/components/`
5. Copy `src/lib/utils.ts` (the cn function) to `packages/ui/src/lib/utils.ts`
6. Create `packages/ui/src/index.ts` barrel export:
```typescript
// Components
export { Button, buttonVariants } from './components/button';
export { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from './components/card';
export { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger, DialogClose } from './components/dialog';
export { Input } from './components/input';
export { Label } from './components/label';
export { Collapsible, CollapsibleContent, CollapsibleTrigger } from './components/collapsible';
export { Separator } from './components/separator';
export { Sheet, SheetClose, SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetTitle, SheetTrigger } from './components/sheet';

// Utils
export { cn } from './lib/utils';
```
7. Update imports in copied components to use relative paths (e.g., change `@/lib/utils` to `../lib/utils`)
8. Run `pnpm --filter @packages/ui build` to verify compilation
  </action>
  <verify>
- `pnpm --filter @packages/ui build` succeeds
- `packages/ui/dist/index.js` and `packages/ui/dist/index.d.ts` exist
- `cat packages/ui/dist/index.d.ts` shows exported types
  </verify>
  <done>@packages/ui built with all Radix-based UI components and cn utility</done>
</task>

<task type="auto">
  <name>Task 2: Set up @packages/api-client with React Query</name>
  <files>
    - packages/api-client/package.json
    - packages/api-client/tsconfig.json
    - packages/api-client/src/index.ts
    - packages/api-client/src/query-client.ts
    - packages/api-client/src/http.ts
  </files>
  <action>
1. Create `packages/api-client/package.json`:
```json
{
  "name": "@packages/api-client",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "tsc -b",
    "dev": "tsc -b --watch"
  },
  "peerDependencies": {
    "react": "^19.0.0"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.90.17"
  }
}
```
2. Create `packages/api-client/tsconfig.json`:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"]
}
```
3. Copy and adapt `src/lib/api/http.ts` to `packages/api-client/src/http.ts`
4. Copy and adapt `src/lib/react-query/queryClient.ts` to `packages/api-client/src/query-client.ts`
5. Create `packages/api-client/src/index.ts`:
```typescript
export { queryClient } from './query-client';
export { http } from './http';
```
6. Run `pnpm --filter @packages/api-client build`
  </action>
  <verify>
- `pnpm --filter @packages/api-client build` succeeds
- `packages/api-client/dist/index.d.ts` exists with QueryClient export
  </verify>
  <done>@packages/api-client built with React Query setup and http utility</done>
</task>

<task type="auto">
  <name>Task 3: Set up @packages/event-bus with typed mitt</name>
  <files>
    - packages/event-bus/package.json
    - packages/event-bus/tsconfig.json
    - packages/event-bus/src/index.ts
    - packages/event-bus/src/events.ts
    - packages/event-bus/src/bus.ts
  </files>
  <action>
1. Create `packages/event-bus/package.json`:
```json
{
  "name": "@packages/event-bus",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "tsc -b",
    "dev": "tsc -b --watch"
  },
  "dependencies": {
    "mitt": "^3.0.1"
  }
}
```
2. Create `packages/event-bus/tsconfig.json`:
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"]
}
```
3. Create `packages/event-bus/src/events.ts` with typed event definitions:
```typescript
// MFE-prefixed events for cross-MFE communication
export type MfeEvents = {
  // Auth events (shell-level)
  'auth:login': { userId: string; role: string };
  'auth:logout': undefined;

  // Rental workflow events
  'rent-mfe:completed': { reservationId: string };
  'rent-mfe:started': { reservationId: string };

  // Return workflow events
  'return-mfe:completed': { reservationId: string };

  // Dashboard refresh events
  'dashboard-mfe:refresh-requested': undefined;

  // Navigation events
  'shell:navigate': { to: string };
};
```
4. Create `packages/event-bus/src/bus.ts`:
```typescript
import mitt from 'mitt';
import type { MfeEvents } from './events';

export const eventBus = mitt<MfeEvents>();
```
5. Create `packages/event-bus/src/index.ts`:
```typescript
export { eventBus } from './bus';
export type { MfeEvents } from './events';
```
6. Run `pnpm --filter @packages/event-bus build`
  </action>
  <verify>
- `pnpm --filter @packages/event-bus build` succeeds
- `packages/event-bus/dist/events.d.ts` shows MfeEvents type
  </verify>
  <done>@packages/event-bus built with typed mitt event bus</done>
</task>

</tasks>

<verification>
- All three packages build independently: `pnpm -r build`
- `pnpm list -r` shows all packages with correct names
- Each package has dist/ with .js and .d.ts files

Note: Verification that workspace packages can be imported by shell happens in Plan 01-04 when shell is configured with workspace dependencies.
</verification>

<success_criteria>
- @packages/ui, @packages/api-client, @packages/event-bus all build successfully
- TypeScript declarations generated for all exports
- Packages use workspace:* protocol when referenced
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure/01-02-SUMMARY.md`
</output>
